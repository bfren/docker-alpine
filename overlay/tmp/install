#!/bin/sh

set -euo pipefail
export BF_E=`basename ${0}`


#======================================================================================================================
# Upgrade to current versions of binaries.
#======================================================================================================================

if [ "${BF_UPGRADE_PACKAGES-}" = "1" ] ; then
    bf-echo "Upgrading binaries..."
    apk upgrade --no-cache
    bf-done
fi


#======================================================================================================================
# Get esh version.
#======================================================================================================================

cd /tmp

ESH_VERSION=$(cat ESH_BUILD)
bf-echo "esh version ${ESH_VERSION}."


#======================================================================================================================
# Install esh template engine.
#======================================================================================================================

bf-echo "Installing esh v${ESH_VERSION}..."
apk add --no-cache esh=${ESH_VERSION} && bf-done \
    || bf-error "esh not installed."


#======================================================================================================================
# Install other packages.
#======================================================================================================================

bf-echo "Installing additional packages..."
apk add --no-cache figlet nu@edgetest && bf-done \
    || bf-error "Unable to install additional packages."


#======================================================================================================================
# Set timezone.
#======================================================================================================================

bf-tz "Europe/London"
