#!/usr/bin/nu

use bf

def main [] {
    # upgrade to current versions of binaries
    if (bf env check UPGRADE_PACKAGES) {
        bf write "Upgrading binaries."
        do { ^apk upgrade --no-cache } | ignore
    }

    # get esh version and install
    cd /tmp
    try {
        let esh_version = cat ESH_BUILD
        bf write $"Installing esh v($esh_version)."
        bf install add [$"esh=($esh_version)"]
    } catch {
        bf write error "esh not installed."
    }

    # install additional packages
    try {
        bf write "Installing additional packages."
        bf install add [figlet]
    } catch {
        bf write error "Unable to install additional packages."
    }

    # set timezone
    bf tz "Europe/London"
}
